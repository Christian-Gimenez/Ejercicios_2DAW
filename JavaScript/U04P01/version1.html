<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="worldcities.js"></script>
</head>

<body>
  <script>
    resultado = csvAMatriz(datos);
    function csvAMatriz(cadena, sepReg = "\n", sepCamp = ";") {
      const array = cadena.split(sepReg)
        .map(linea => linea.trim())
        .filter(linea => linea.length)
        .map(linea => linea
          .split(sepCamp)
          .map(registro => registro.trim())
          .filter(registro => registro.length))
        .filter(linea => linea.length === 11);
      return array;
    }
    //console.dir(resultado);

    function extraerCabecera(matriz) {
      return matriz.shift();
    }

    const cabecera = extraerCabecera(resultado);
    //console.dir(resultado);

    function indiceCampoCabecera(cabecera, campo) {
      return cabecera.findIndex(valor => valor === campo);
    }
    //console.log(indiceCampoCabecera(cabecera, "lng"));

    function filtrarPorNumCampo(matriz, numCampo, valor) {
      return matriz.filter((linea) => linea[numCampo] === valor);
    }
    //console.dir(filtrarPorNumCampo(resultado, 8, "admin"));

    function realizarTabla(cabecera, matriz, caption) {
      document.write("<table border='1px solid black'>");
      document.write("<caption><h1>" + caption + "</h1></caption>");

      document.write("<tr>");
      cabecera.forEach(registro => document.write("<th>" + registro + "</th>"));
      document.write("</tr>");

      matriz.forEach(fila => {
        document.write("<tr>");
        fila.forEach(registro => document.write("<td>" + registro + "</td>"));
        document.write("</tr>");
      });
      document.write("</table>");
    }
    realizarTabla(cabecera.map(registro => registro.toUpperCase()), resultado, "TABLA DE PAÍSES");

    /* campo1 | campo2 | campo3
    -----------------------------
       4      | 23     | 143    
    -----------------------------
       88     | 9      | 5    
    */

    function ordenarPorCampo(matriz, campo) {
      return matriz.sort((a, b) => {
        return a[campo] > b[campo] ? 1 : -1;
      })
    }



    function arrDeObj(arrays, cabecera) {
      function aObjeto(array) {
        return array.reduce((acc, valor, i) => {
          acc[cabecera[i]] = valor;
          return acc; 
        }, {});
      }
      return arrays.map(linea => aObjeto(linea));
    }
    console.dir(ordenarPorCampo(resultado, 1));
    const arrObj = arrDeObj(resultado, cabecera);
    console.dir(arrObj);
  </script>
</body>

</html>